# iPSc Recognition Algorithm

This algorithm uses a UNet model to identify IPS cells from raw images, and then calculates corresponding mechanical coordinates for subsequent experiments.

## System Requirements
This program is supported for windows and Linux. The program has been tested on the following systems:

Windows10  
Linux: Ubuntu 16.04 and above

### Hardware requirements
Due to the implementation of deep learning algorithms, it is recommended to configure GPU devices, particularly NVIDIA graphics cards, and install the corresponding CUDA software. The use of CPU processing is not advisable due to its slow speed.

### Software requirements
Required python >= 3.7

Required python packages include:  
torch (note: please install the version of torch that is compatible with the CUDA version installed on the system. For installation details, please refer to the PyTorch official guide)  
numpy  
opencv-python  
pytest (used for testing)

## Installation and Run
``` sh

git clone https://github.com/bpkcl630/iPScCloneIdentification
cd iPScCloneIdentification
python3 main.py
```

## Folder Structure:
- data: Contains raw data. sample data can be downloaded from https://drive.google.com/drive/folders/1AyVUeIwdVDdfKOLvTKrbAahflSVLTjpw?usp=sharing
- lib: Contains function interface files  
- model: Contains model structure files  
- result: Contains result files (can be deleted)

## Class: Detector_Ips
This class contains many default tuning parameters and has two main interfaces.

### 1. Detector_Ips.segment(im_ori: np.array)
This method uses a trained UNet model to extract information about all iPS cells from the raw image.

#### Parameters:
- im_ori: The raw image in np.array format.

#### Return:
- im_eval: A binary image with IPS cells as foreground (pixel value = 255) and background as 0.
![im_ori](./data/2022_11_26_13_55_34D17_ori.png)
![im_eval](./result/2022_11_26_13_55_34D17_eval.png)


### 2. Detector_Ips.get_target(im_ori: np.array, im_eval: np.array)
This method takes in the raw and binary images, and returns a colored image with markings indicating the target IPS cells, along with their coordinates.

#### Parameters:
- im_ori: The raw image in np.array format. 
- im_eval: The binary image in np.array format, generated by the Detector_Ips.segment() method.

#### Return:
- im_label: A colored image with markings indicating the target IPS cells, mainly used for result verification. Not necessary for actual use. (Green portion indicates target IPS cells.)
- locs: A list of coordinates for the target IPS cells.

![im_label](./result/2022_11_26_13_55_34D17_ori_targets.png)





